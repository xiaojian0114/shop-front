# 微信小程序连接本地后端配置说明

## 问题原因

微信小程序无法直接使用 `localhost` 或 `127.0.0.1` 连接本地后端，必须使用**电脑的局域网IP地址**。

---

## 解决步骤

### 第一步：获取电脑的局域网IP地址

#### Windows系统：
1. 按 `Win + R` 打开运行窗口
2. 输入 `cmd` 回车
3. 在命令行中输入：`ipconfig`
4. 找到"无线局域网适配器 WLAN"或"以太网适配器"下的 **IPv4 地址**
5. 例如：`192.168.1.100` 或 `192.168.0.105`

#### Mac系统：
1. 打开"系统偏好设置" → "网络"
2. 选择当前连接的网络（WiFi或以太网）
3. 查看右侧显示的 **IP地址**

#### Linux系统：
在终端运行：`ifconfig` 或 `ip addr`，找到 `inet` 地址

---

### 第二步：修改代码配置

已自动修改 `src/utils/request.js` 文件，请按以下步骤操作：

1. 打开 `src/utils/request.js` 文件
2. 找到微信小程序环境的配置部分：
   ```javascript
   // #ifdef MP-WEIXIN
   BASE_URL = "http://192.168.1.100:8080"; // 请修改为你的电脑局域网IP
   ```
3. 将 `192.168.1.100` 替换为你第一步获取的IP地址
4. 确保端口号 `8080` 与你的后端服务端口一致

---

### 第三步：配置微信开发者工具

1. 打开微信开发者工具
2. 点击右上角的"详情"按钮
3. 在"本地设置"标签页中：
   - ✅ **勾选** "不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
   - ✅ **勾选** "不校验安全域名"

---

### 第四步：确保网络连接

1. **手机和电脑必须在同一WiFi网络下**
2. **确保电脑防火墙允许8080端口访问**
   - Windows：控制面板 → Windows Defender 防火墙 → 允许应用通过防火墙
   - Mac：系统偏好设置 → 安全性与隐私 → 防火墙 → 防火墙选项

---

### 第五步：测试连接

1. 启动后端服务（确保在8080端口运行）
2. 在微信开发者工具中编译运行小程序
3. 查看控制台是否有网络请求
4. 如果出现"网络错误"，检查：
   - IP地址是否正确
   - 后端服务是否正常运行
   - 防火墙是否阻止了连接

---

## 常见问题

### Q1: 还是连接不上？
**A**: 
- 检查IP地址是否正确（必须是局域网IP，不是127.0.0.1）
- 检查手机和电脑是否在同一WiFi
- 检查后端服务是否正常运行
- 检查防火墙设置

### Q2: 如何查看后端服务是否正常运行？
**A**: 
- 在浏览器访问 `http://你的IP:8080` 看是否能访问
- 或者访问 `http://你的IP:8080/health` 等健康检查接口

### Q3: IP地址经常变化怎么办？
**A**: 
- 可以在路由器中为电脑设置静态IP
- 或者每次开发前重新获取IP并更新配置
- 也可以使用远程服务器地址（`http://121.4.51.19:8080`）

### Q4: 可以使用远程服务器吗？
**A**: 
可以！如果不想配置本地IP，可以直接使用远程服务器：
```javascript
// #ifdef MP-WEIXIN
BASE_URL = "http://121.4.51.19:8080"; // 使用远程服务器
// #endif
```

---

## 配置示例

假设你的电脑局域网IP是 `192.168.0.105`，后端端口是 `8080`：

```javascript
// #ifdef MP-WEIXIN
BASE_URL = "http://192.168.0.105:8080";
// #endif
```

---

## 注意事项

1. ⚠️ **开发阶段**：必须关闭域名校验（已在manifest.json中设置 `urlCheck: false`）
2. ⚠️ **生产环境**：必须使用已备案的HTTPS域名，并在微信公众平台配置合法域名
3. ⚠️ **局域网IP**：每次电脑重新连接WiFi可能会变化，需要重新配置

---

**配置完成后，重新编译小程序即可连接本地后端！** 🎉


