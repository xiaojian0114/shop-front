# 魏航 - 商家端店铺管理功能讲解文档

## 📋 负责模块概览

你负责以下核心模块：
1. **商品管理页面** - 商品展示、上下架 (`src/pages/merchant/index.vue`)
2. **店铺管理页面** - 店铺切换、店铺列表 (`src/pages/merchant/shop.vue`)
3. **店铺详情页面** - 店铺信息展示 (`src/pages/merchant/shop-detail.vue`)
4. **首页商品推荐** - 与客户端共享 (`src/pages/user/index.vue`)

---

## 一、商品管理页面 (`src/pages/merchant/index.vue`)

### 1.1 实现的功能
- **店铺选择器**：切换不同店铺查看商品
- **商品列表展示**：显示所有商品（包括上架和下架）
- **商品状态标签**：销售中/已下架
- **商品上下架操作**：一键上架或下架商品
- **商品详情查看**：跳转到商品详情页
- **添加商品入口**：跳转到添加商品页

### 1.2 实现方法

#### 店铺切换功能
**实现方式**：使用 `picker` 组件实现店铺下拉选择。页面加载时调用 `merchantApi.getMyShops()` 获取店铺列表，切换店铺后重新加载该店铺的商品列表。

**关键方法**：
- `loadShops()` - 加载店铺列表
- `switchShop(e)` - 切换店铺，重新加载商品

**使用的API**：`merchantApi.getMyShops()`

#### 商品列表加载
**实现方式**：调用 `merchantApi.product.getAll(shopId)` 获取所有商品（包括下架商品）。使用 `v-for` 循环渲染商品列表，每个商品显示图片、名称、价格、库存、状态标签和操作按钮。

**关键方法**：
- `loadGoods()` - 加载商品列表

**使用的API**：`merchantApi.product.getAll(shopId)`

#### 商品上下架功能
**实现方式**：点击"上架"或"下架"按钮时，显示确认弹窗。用户确认后调用 `merchantApi.product.onSale(id)` 或 `merchantApi.product.offSale(id)` 接口。操作成功后刷新商品列表。

**关键方法**：
- `toggleSale(goods)` - 切换商品上下架状态

**使用的API**：
- `merchantApi.product.onSale(id)` - 上架商品
- `merchantApi.product.offSale(id)` - 下架商品

#### 商品状态判断
**实现方式**：通过 `isOnSale` 字段判断商品状态。`isOnSale === 1` 表示销售中，`isOnSale === 0` 表示已下架。根据状态显示不同颜色的标签和按钮文字。

### 1.3 核心要点
1. **店铺切换**：使用 `picker` 组件实现店铺选择，切换后重新加载商品
2. **商品状态**：通过 `isOnSale` 字段判断（1=上架，0=下架）
3. **操作确认**：上下架前使用模态框确认，避免误操作
4. **数据刷新**：操作成功后立即刷新商品列表

---

## 二、店铺管理页面 (`src/pages/merchant/shop.vue`)

### 2.1 实现的功能
- **店铺列表展示**：店铺名称、头像、状态、创建时间
- **申请新店铺入口**：跳转到店铺申请页
- **店铺详情查看**：点击卡片跳转到店铺详情页
- **店铺编辑功能**：已通过审核的店铺可编辑名称和头像

### 2.2 实现方法

#### 店铺列表加载
**实现方式**：页面加载时调用 `merchantApi.getMyShops()` 获取店铺列表。使用 `v-for` 循环渲染店铺卡片，每个卡片显示店铺头像、名称、状态和创建时间。

**关键方法**：
- `loadShops()` - 加载店铺列表

**使用的API**：`merchantApi.getMyShops()`

#### 店铺状态显示
**实现方式**：根据 `shop.status` 显示不同状态标签。状态码：0=审核中（橙色），1=已通过（绿色），2=已拒绝（红色）。只有状态为1（已通过）的店铺才能编辑。

**关键方法**：
- `getStatusText(status)` - 获取状态文本
- `getStatusClass(status)` - 获取状态样式类

#### 店铺编辑功能
**实现方式**：点击"编辑店铺"按钮时，检查店铺状态。只有已通过审核的店铺才能编辑。打开编辑弹窗，显示当前店铺信息。可以修改店铺名称和上传新头像。提交时调用 `merchantApi.updateShop()` 更新店铺信息。

**关键方法**：
- `editShop(shop)` - 打开编辑弹窗
- `chooseLogo()` - 选择并上传新头像
- `submitEdit()` - 提交编辑

**使用的API**：
- `merchantApi.uploadImage(filePath)` - 上传图片
- `merchantApi.updateShop({ id, name, logo })` - 更新店铺信息

#### 时间格式化
**实现方式**：将创建时间转换为相对时间显示。今天显示"今天"，昨天显示"昨天"，7天内显示"X天前"，超过7天显示"月-日"格式。

**关键方法**：
- `formatDate(dateString)` - 格式化时间显示

### 2.3 核心要点
1. **店铺状态**：只有状态为 `1`（已通过）的店铺才能编辑
2. **图片上传**：编辑时可以选择新头像，上传后立即更新预览
3. **时间显示**：使用相对时间显示（今天、昨天、X天前）
4. **交互设计**：整个店铺卡片可点击查看详情，编辑按钮单独操作

---

## 三、店铺详情页面 (`src/pages/merchant/shop-detail.vue`)

### 3.1 实现的功能
- **店铺基本信息展示**：名称、头像、状态、描述
- **店铺商品列表展示**：显示该店铺的所有商品
- **商品状态显示**：销售中/已下架
- **空状态提示**：无商品时引导到商品管理页面

### 3.2 实现方法

#### 店铺信息加载
**实现方式**：页面加载时从路由参数获取店铺ID，调用 `merchantApi.getShopDetail(shopId)` 获取店铺详情。设置页面标题为店铺名称。

**关键方法**：
- `loadShopInfo()` - 加载店铺信息

**使用的API**：`merchantApi.getShopDetail(shopId)`

#### 商品列表加载
**实现方式**：调用 `merchantApi.product.getList(shopId)` 获取该店铺的商品列表。使用 `v-for` 循环渲染商品，显示商品图片、名称、价格、库存和状态。

**关键方法**：
- `loadGoods()` - 加载商品列表

**使用的API**：`merchantApi.product.getList(shopId)`

#### 商品详情跳转
**实现方式**：点击商品卡片时，跳转到商品详情页，通过URL参数传递商品ID。

**关键方法**：
- `toDetail(id)` - 跳转到商品详情页

### 3.3 核心要点
1. **只读展示**：此页面主要用于展示，不提供编辑功能
2. **商品状态**：显示商品的上架/下架状态
3. **空状态**：无商品时提示用户去商品管理页面添加

---

## 四、首页商品推荐（共享模块）

### 4.1 功能说明
此模块与客户端首页共享 (`src/pages/user/index.vue`)，详见《龚祺辉-客户端功能讲解.md》中的"一、客户端首页"部分。

### 4.2 你的职责
- 确保首页商品推荐功能正常
- 与客户端开发者协调推荐算法（如有）
- 确保推荐商品数据准确

---

## 五、技术要点总结

### 5.1 店铺切换机制
**实现位置**：`src/pages/merchant/index.vue` 的 `switchShop()` 方法

**实现步骤**：
1. 获取店铺列表：调用 `getMyShops()` 获取所有店铺
2. 使用Picker组件：通过 `picker` 组件实现下拉选择
3. 切换后刷新：切换店铺后重新加载该店铺的商品

### 5.2 商品状态管理
- **上架状态**：`isOnSale === 1` 表示销售中
- **下架状态**：`isOnSale === 0` 表示已下架
- **状态切换**：通过 `onSale()` 和 `offSale()` API切换

### 5.3 图片URL处理
**实现位置**：`src/utils/image.js` 工具函数

项目中图片URL有多种格式，需要统一处理：
- **完整URL**：直接使用
- **OSS URL**：添加 `https://` 前缀
- **相对路径**：拼接 `BASE_URL`

### 5.4 店铺状态码
- `0` - 审核中（等待管理员审核）
- `1` - 已通过（可以正常使用和编辑）
- `2` - 已拒绝（申请被拒绝）

### 5.5 数据刷新策略
- **操作后刷新**：上下架、编辑店铺后立即刷新列表
- **页面显示刷新**：`onShow` 生命周期中刷新数据
- **下拉刷新**：支持下拉刷新功能

---

## 六、常见问题与解决方案

### Q1: 切换店铺后商品列表不更新？
**A**: 
- 检查 `switchShop` 方法是否正确调用 `loadGoods()`（`src/pages/merchant/index.vue`）
- 检查 `currentShop` 是否正确更新
- 检查后端接口是否正常返回数据

### Q2: 商品上下架操作失败？
**A**: 
- 检查商品ID是否正确传递（`src/pages/merchant/index.vue`）
- 检查后端接口是否正常
- 检查当前用户是否有操作权限
- 查看控制台错误信息

### Q3: 店铺编辑后不保存？
**A**: 
- 检查 `updateShop` API是否正常（`src/pages/merchant/shop.vue`）
- 检查表单数据是否正确传递
- 检查店铺状态是否为"已通过"（只有已通过的店铺才能编辑）

### Q4: 图片不显示？
**A**: 
- 检查图片URL格式是否正确
- 检查OSS图片是否存在
- 使用 `getShopLogoUrl` 或 `getProductImageUrl` 工具函数处理URL（`src/utils/image.js`）

### Q5: 店铺列表为空？
**A**: 
- 检查是否已申请店铺（`src/pages/merchant/shop.vue`）
- 检查店铺审核状态
- 检查后端接口是否正常

---

## 七、代码规范建议

1. **命名规范**：使用驼峰命名，方法名使用动词开头
2. **注释规范**：关键逻辑添加注释说明
3. **错误处理**：所有异步操作都要有错误处理
4. **用户体验**：加载状态提示，操作反馈及时
5. **数据验证**：操作前验证数据有效性

---

## 八、扩展功能建议

1. **商品管理**：
   - 添加商品搜索功能
   - 添加商品批量操作（批量上架/下架）
   - 添加商品排序功能

2. **店铺管理**：
   - 添加店铺数据统计（销售额、订单数等）
   - 添加店铺设置功能（营业时间、联系方式等）
   - 添加店铺公告功能

3. **数据概览**：
   - 添加销售数据图表
   - 添加商品分类统计
   - 添加热门商品排行

---

**文档版本**: v2.0  
**最后更新**: 2024年  
**维护者**: 魏航
