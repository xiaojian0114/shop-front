# 赵媛丽 - 登录注册、购物车、支付功能讲解文档

## 📋 负责模块概览

你负责以下核心模块：
1. **登录注册页面** - 用户认证 (`src/pages/auth/login.vue`)
2. **购物车页面** - 商品管理 (`src/pages/user/cart.vue`)
3. **订单确认页面** - 支付流程 (`src/pages/common/order-confirm.vue`)
4. **页面设计与美化** - 整体UI/UX优化

---

## 一、登录注册页面 (`src/pages/auth/login.vue`)

### 1.1 实现的功能
- **登录/注册切换**：标签页切换登录和注册模式
- **手机号输入与验证**：11位手机号格式验证
- **密码输入**：登录时隐藏，注册时显示
- **角色选择**：注册时选择学生或商家角色
- **表单验证**：手机号格式、密码长度验证
- **登录/注册成功后跳转**：根据角色跳转到对应首页

### 1.2 实现方法

#### 登录/注册切换
**实现方式**：使用 `isLogin` 变量控制显示登录还是注册表单。点击标签页时切换 `isLogin` 的值，使用 `:class` 绑定实现标签页高亮效果。

#### 表单验证
**实现方式**：提交前进行前端验证。手机号使用正则表达式 `/^1[3-9]\d{9}$/` 验证11位格式，密码验证长度至少6位。验证失败时使用 `uni.showToast` 提示用户。

**关键方法**：
- `submit()` - 提交前验证表单

#### 登录/注册功能
**实现方式**：验证通过后，根据 `isLogin` 的值调用 `authApi.login()` 或 `authApi.register()` 接口。登录时传递手机号和密码，注册时额外传递角色（user/merchant）。成功后保存token和用户信息到本地存储，然后根据角色跳转到对应首页。

**关键方法**：
- `submit()` - 提交登录/注册
- `handleAuthSuccess(userInfo)` - 处理认证成功

**使用的API**：
- `authApi.login({ phone, password })` - 用户登录
- `authApi.register({ phone, password, role })` - 用户注册

#### 自动跳转功能
**实现方式**：页面显示时（`onShow` 生命周期）检查本地是否有token和用户信息。如果已登录，根据用户角色自动跳转到对应首页（商家跳转到 `/pages/merchant/index`，用户跳转到 `/pages/user/index`）。

**关键方法**：
- `onShow()` - 检查登录状态并自动跳转

#### 跨平台跳转
**实现方式**：H5环境和小程序环境使用不同的跳转方式。H5开发环境使用 `history.replaceState` 和 `location.reload`，其他环境使用 `uni.reLaunch`。

**关键方法**：
- `goto(path)` - 跨平台跳转函数

### 1.3 核心要点
1. **表单验证**：前端验证手机号格式（11位，1开头）和密码长度（至少6位）
2. **角色选择**：注册时选择角色（user/merchant），决定登录后跳转的首页
3. **本地存储**：登录成功后保存 `token` 和 `userInfo` 到本地
4. **自动跳转**：已登录用户访问登录页时自动跳转首页
5. **跨平台兼容**：H5和小程序使用不同的跳转方式

---

## 二、购物车页面 (`src/pages/user/cart.vue`)

### 2.1 实现的功能
- **购物车商品列表展示**：显示所有购物车商品
- **商品选择功能**：单选、全选
- **商品数量修改**：增减按钮、直接输入
- **编辑模式**：批量删除商品
- **结算功能**：跳转到订单确认页
- **空状态提示**：购物车为空时显示友好提示

### 2.2 实现方法

#### 购物车列表加载
**实现方式**：页面显示时调用 `userApi.getCartList()` 获取购物车列表。将返回的数据映射为前端需要的格式，每个商品默认选中（`checked: true`）。

**关键方法**：
- `loadCart()` - 加载购物车列表

**使用的API**：`userApi.getCartList()`

#### 商品选择功能
**实现方式**：使用计算属性 `selectedCount` 计算已选商品数量，`allChecked` 判断是否全选。点击复选框时切换商品的 `checked` 状态，点击全选时批量切换所有商品的选中状态。

**关键方法**：
- `toggleItem(item)` - 切换单个商品选中状态
- `toggleAll()` - 全选/全不选

**计算属性**：
- `selectedCount` - 已选商品数量
- `allChecked` - 是否全选

#### 商品数量修改
**实现方式**：点击增减按钮时调用 `changeNum()` 方法，修改数量后立即调用 `userApi.updateCartItem()` 同步到服务器。支持直接输入数量，输入后验证并同步。

**关键方法**：
- `changeNum(item, delta)` - 修改商品数量
- `validateNum(item)` - 验证数量输入

**使用的API**：`userApi.updateCartItem({ productId, num })`

#### 编辑模式
**实现方式**：点击"管理"按钮切换编辑模式。编辑模式下显示删除按钮，可以批量删除选中的商品。退出编辑模式时，如果没有任何选中商品，则默认全选。

**关键方法**：
- `toggleEdit()` - 切换编辑模式
- `removeItem(item)` - 删除单个商品
- `handleAction()` - 批量删除或结算

**使用的API**：
- `userApi.deleteCartItem({ productId })` - 删除单个商品
- `userApi.batchDeleteCartItems(productIds)` - 批量删除商品

#### 结算功能
**实现方式**：非编辑模式下，点击"结算"按钮时，筛选出选中的商品，将商品ID通过URL参数传递到订单确认页。

**关键方法**：
- `handleAction()` - 结算操作

### 2.3 核心要点
1. **编辑模式**：切换编辑模式可以批量删除商品
2. **数量同步**：修改数量后立即同步到服务器
3. **选中状态**：默认所有商品选中，退出编辑模式时如果没有选中则全选
4. **结算跳转**：将选中的商品ID通过URL参数传递到订单确认页
5. **空状态**：购物车为空时显示友好提示

---

## 三、订单确认页面 (`src/pages/common/order-confirm.vue`)

### 3.1 实现的功能
- **收货地址输入**：输入收货地址
- **收货人信息输入**：姓名、电话
- **商品信息展示**：显示要结算的商品列表
- **订单总额计算**：自动计算商品总价
- **提交订单**：创建订单并跳转

### 3.2 实现方法

#### 商品信息加载
**实现方式**：页面加载时从URL参数获取商品ID数组（`ids=1,2,3`）。调用 `userApi.getCartList()` 获取购物车所有商品，然后筛选出要结算的商品。

**关键方法**：
- `loadGoods()` - 加载商品信息

**使用的API**：`userApi.getCartList()`

#### 用户信息预填
**实现方式**：页面加载时调用 `userApi.getUserInfo()` 获取用户信息，自动填充收货人姓名和电话到输入框。

**关键方法**：
- `loadUserInfo()` - 加载用户信息

**使用的API**：`userApi.getUserInfo()`

#### 订单总额计算
**实现方式**：使用计算属性 `total` 计算订单总额。遍历商品列表，累加每个商品的价格乘以数量。

**计算属性**：
- `total` - 订单总额

#### 提交订单
**实现方式**：提交前验证所有必填项（姓名、电话、地址）。验证通过后调用 `orderApi.submitOrder()` 提交订单，传递商品ID数组、地址、姓名、电话。成功后显示订单号，然后跳转到个人中心。

**关键方法**：
- `submitOrder()` - 提交订单

**使用的API**：`orderApi.submitOrder({ productIds, address, nickname, phone })`

### 3.3 核心要点
1. **商品来源**：从购物车中筛选出要结算的商品
2. **信息预填**：自动加载用户信息填充姓名和电话
3. **表单验证**：提交前验证所有必填项
4. **订单号显示**：下单成功后显示订单号
5. **跳转逻辑**：下单成功后跳转到个人中心（订单列表）

---

## 四、页面设计与美化

### 4.1 设计原则
1. **统一性**：使用统一的设计语言（颜色、字体、间距、圆角、阴影）
2. **一致性**：相同功能的组件样式保持一致
3. **反馈性**：操作后及时反馈（加载状态、成功提示、错误提示）
4. **易用性**：界面简洁清晰，操作流程顺畅

### 4.2 颜色规范
**实现位置**：SCSS变量文件

- **主色调**：`#ff6b00`（橙色）
- **渐变色**：`linear-gradient(135deg, #ff6b00, #ff8c42)`
- **功能色**：成功（绿色 `#07c160`）、错误（红色 `#ff4444`）、警告（橙色 `#ff9900`）

### 4.3 间距规范
- `$uni-padding-xs: 10rpx`
- `$uni-padding-sm: 20rpx`
- `$uni-padding-base: 30rpx`
- `$uni-padding-lg: 40rpx`
- `$uni-padding-xl: 50rpx`

### 4.4 圆角规范
- `$uni-border-radius-base: 16rpx`
- `$uni-border-radius-lg: 24rpx`
- `$uni-border-radius-xl: 32rpx`
- `$uni-border-radius-round: 999rpx`（圆形）

### 4.5 阴影规范
- `$uni-shadow-sm: 0 2rpx 8rpx rgba(0, 0, 0, 0.06)`
- `$uni-shadow-base: 0 4rpx 12rpx rgba(0, 0, 0, 0.08)`
- `$uni-shadow-lg: 0 8rpx 24rpx rgba(0, 0, 0, 0.12)`
- `$uni-shadow-button: 0 8rpx 20rpx rgba(255, 107, 0, 0.3)`

### 4.6 按钮样式
**实现位置**：各页面的样式部分

主按钮使用渐变背景、圆角、阴影，点击时有轻微下压效果（`transform: translateY(2rpx)`）。

### 4.7 卡片样式
**实现位置**：各页面的样式部分

卡片使用白色背景、圆角、阴影，点击时有阴影加深效果。

---

## 五、技术要点总结

### 5.1 本地存储
**实现位置**：`src/pages/auth/login.vue` 的 `handleAuthSuccess()` 方法

- **Token存储**：`uni.setStorageSync("token", token)`
- **用户信息存储**：`uni.setStorageSync("userInfo", userInfo)`
- **读取存储**：`uni.getStorageSync("token")`
- **清除存储**：`uni.clearStorageSync()`（退出登录时）

### 5.2 路由导航
- `uni.navigateTo()` - 保留当前页面，跳转到新页面
- `uni.switchTab()` - 跳转到tabBar页面
- `uni.reLaunch()` - 关闭所有页面，打开新页面
- `uni.navigateBack()` - 返回上一页

### 5.3 表单验证
**实现位置**：`src/pages/auth/login.vue` 和 `src/pages/common/order-confirm.vue`

- **前端验证**：手机号格式、密码长度、必填项
- **后端验证**：最终数据验证由后端完成
- **用户提示**：验证失败时使用 `uni.showToast` 提示

### 5.4 状态管理
- 使用 `data()` 管理组件状态
- 使用 `computed` 计算派生状态（如购物车总价、已选数量）
- 使用本地存储持久化用户信息

### 5.5 错误处理
- 所有异步操作使用 `try-catch` 捕获错误
- 使用 `uni.showToast` 显示用户友好的错误提示
- 关键操作失败时提供重试机制

---

## 六、常见问题与解决方案

### Q1: 登录后不跳转？
**A**: 
- 检查 `handleAuthSuccess` 方法是否正确调用（`src/pages/auth/login.vue`）
- 检查 `goto` 函数是否正常工作
- 检查路由配置是否正确

### Q2: 购物车数量不更新？
**A**: 
- 检查 `changeNum` 方法是否正确调用API（`src/pages/user/cart.vue`）
- 检查API返回数据是否正确
- 检查本地数据是否同步更新

### Q3: 提交订单失败？
**A**: 
- 检查表单验证是否通过（`src/pages/common/order-confirm.vue`）
- 检查商品ID是否正确传递
- 检查后端接口是否正常
- 查看控制台错误信息

### Q4: 页面样式不统一？
**A**: 
- 使用统一的SCSS变量
- 参考设计规范文档
- 检查是否有内联样式覆盖

---

## 七、代码规范建议

1. **命名规范**：使用驼峰命名，方法名使用动词开头
2. **注释规范**：关键逻辑添加注释说明
3. **错误处理**：所有异步操作都要有错误处理
4. **用户体验**：加载状态提示，操作反馈及时
5. **代码复用**：公共样式和逻辑提取为工具函数

---

## 八、扩展功能建议

1. **登录注册**：
   - 添加记住密码功能
   - 添加验证码登录
   - 添加第三方登录（微信、QQ等）

2. **购物车**：
   - 添加商品规格选择
   - 添加商品收藏功能
   - 添加购物车商品推荐

3. **订单确认**：
   - 添加收货地址管理
   - 添加优惠券选择
   - 添加发票信息填写

4. **页面美化**：
   - 添加动画效果
   - 优化加载状态
   - 添加骨架屏

---

**文档版本**: v2.0  
**最后更新**: 2024年  
**维护者**: 赵媛丽
